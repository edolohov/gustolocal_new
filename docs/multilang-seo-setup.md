# Настройка SEO для мультиязычного сайта

## Что было добавлено

### 1. Файл `multilang-seo-functions.php`

Добавлен новый файл с SEO функциями:
- ✅ Hreflang теги для всех языковых версий
- ✅ Автоматическое определение языка при первом визите
- ✅ Правильные canonical URLs
- ✅ Языковые атрибуты в HTML
- ✅ Open Graph теги для соцсетей

### 2. Автоматическое определение языка

**Приоритет:**
1. Cookie (если пользователь уже выбирал язык)
2. Accept-Language заголовок браузера
3. По умолчанию - русский (не редиректит)

**Как работает:**
- При первом визите проверяется язык браузера
- Если это ES или EN, пользователь автоматически редиректится на `/es/` или `/en/`
- Выбор сохраняется в cookie на 30 дней

### 3. Hreflang теги

Автоматически добавляются в `<head>` для всех страниц:
```html
<link rel="alternate" hreflang="ru" href="https://example.com/page/" />
<link rel="alternate" hreflang="es" href="https://example.com/es/page/" />
<link rel="alternate" hreflang="en" href="https://example.com/en/page/" />
<link rel="alternate" hreflang="x-default" href="https://example.com/" />
```

## Что нужно проверить

### 1. Проверка hreflang тегов

1. Откройте любую страницу сайта
2. Посмотрите исходный код (View Source)
3. В `<head>` должны быть теги `<link rel="alternate" hreflang="...">`

Или используйте инструмент: https://www.google.com/webmasters/tools/i18n/

### 2. Проверка автоматического определения языка

1. Очистите cookies для вашего сайта
2. Измените язык браузера на испанский или английский
3. Откройте сайт - должен произойти редирект на `/es/` или `/en/`

### 3. Проверка в Google Search Console

1. Добавьте все языковые версии сайта:
   - `example.com` (RU)
   - `example.com/es/` (ES)
   - `example.com/en/` (EN)

2. Проверьте индексацию каждой версии

3. Мониторьте ошибки hreflang (если есть)

### 4. Проверка canonical URLs

Убедитесь, что каждая языковая версия имеет правильный canonical URL:
- RU: `https://example.com/page/`
- ES: `https://example.com/es/page/`
- EN: `https://example.com/en/page/`

## Настройка переключения языка

### Вариант 1: Через GET параметр

Добавьте ссылки переключения языка:
```php
<a href="<?php echo esc_url(add_query_arg('lang', 'es')); ?>">Español</a>
<a href="<?php echo esc_url(add_query_arg('lang', 'en')); ?>">English</a>
<a href="<?php echo esc_url(add_query_arg('lang', 'ru')); ?>">Русский</a>
```

### Вариант 2: Прямые ссылки

```php
<a href="<?php echo home_url('/es/'); ?>">Español</a>
<a href="<?php echo home_url('/en/'); ?>">English</a>
<a href="<?php echo home_url('/'); ?>">Русский</a>
```

## Важные замечания

### 1. Отдельные страницы для каждого языка

Для лучшего SEO рекомендуется создавать отдельные страницы:
- `page-name` (RU)
- `page-name-es` (ES)
- `page-name-en` (EN)

Текущая система уже поддерживает это через суффиксы `-es` и `-en`.

### 2. Перевод контента

- ✅ WooCommerce строки переводятся через `translations.php`
- ✅ Кастомные билдеры переводятся через `meal-builder-multilang.php`
- ⚠️ Контент страниц нужно переводить вручную или через плагины

### 3. Производительность

Автоматическое определение языка работает только при первом визите. После сохранения в cookie редиректы не происходят.

## Отключение автоматического определения языка

Если нужно отключить автоматический редирект, закомментируйте строку в `functions.php`:

```php
// require_once get_template_directory() . '/multilang-seo-functions.php';
```

Или добавьте проверку в функцию `auto_detect_language_redirect()`.

## Следующие шаги

1. ✅ Проверить работу hreflang тегов
2. ✅ Протестировать автоматическое определение языка
3. ⚠️ Создать XML sitemap для каждого языка (рекомендуется использовать плагин)
4. ⚠️ Добавить мета-теги (title, description) для каждой языковой версии
5. ⚠️ Настроить Google Search Console для всех языков
6. ⚠️ Проверить индексацию в Google

## Проблемы и решения

### Hreflang теги не появляются

- Проверьте, что файл подключен в `functions.php`
- Убедитесь, что функция `get_current_language()` работает правильно
- Проверьте, что есть языковые версии страниц

### Автоматический редирект не работает

- Проверьте, что нет языкового префикса в URL
- Убедитесь, что это не админка или API запрос
- Проверьте настройки браузера (Accept-Language)

### Неправильные URL в hreflang

- Проверьте функцию `get_language_versions()`
- Убедитесь, что страницы с суффиксами `-es` и `-en` существуют
- Для WooCommerce страниц проверьте правильность slug

